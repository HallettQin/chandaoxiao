{include file="page_header"}
<header class="dis-box header-menu n-header-menu new-goods-nav ts-5">
    <h3 class="box-flex">
        <nav class="t-goods-shop-list-nav box-flex swiper-container-horizontal "><!-- goods-list-nav-new -->
            <ul class="swiper-wrapper  dis-box text-c goods-ul">
                <a class="a-icon-back box-flex left"  href="javascript:history.go(-1);"><i class="iconfont icon-jiantou1 col-7"></i></a>
                <li class="div1 box-flex swiper-slide active position-rel swiper-slide-active" category="1">
                    <a class="product-div-link j-goods-shop" href="javascript:;"></a>商品</li>
                <li class="div3 box-flex swiper-slide position-rel swiper-slide-next" category="3">
                    <a class="product-div-link j-goods-detail" href="{url('groupbuy/index/info', array('id'=>$group_buy_id))}"></a>详情</li>
                <li class="div4 box-flex swiper-slide position-rel" category="4">
                    <a class="product-div-link" href="{url('groupbuy/index/comment', array('id'=>$group_buy_id))}"></a>评论</li>
                <a class="box-flex right filter-btn-shop filter-btn-a" href="{url('cart/index/index')}"><i class="iconfont icon-gouwuche col-7"></i></a>
            </ul>
        </nav>
    </h3>
</header>
<div class="con">
	<form name="ECS_FORMBUY" action="{url('buy')}" id="ECS_FORMBUY" method="post" onsubmit="return get_groupbuy();">
			<div class="goods">
				<div class="goods-banner goods-photo j-show-goods-img">
					<div id="fnTimeCountDown" class="group-time-box" data-end="{$group_buy.formated_end_date}">
						<span class="day">00</span>天
						<span class="hour">00</span>时
						<span class="mini">00</span>分
						<span class="sec">00</span>秒
					</div>
					<span class="goods-num" id="goods-num">
						<span id="g-active-num"></span>/<span id="g-all-num"></span>
					</span>
						<div class="swiper-wrapper my-gallery-box" data-pswp-uid="10">
						{foreach $goods_img as $goods_img}
						<figure class="swiper-slide tb-lr-center">
							<div class="img-box">
							<a href="{$goods_img.img_url}" data-size="640x640">
								<img src="{$goods_img.img_url}" />
							</a>
						</div>
						</figure>
						{/foreach}
					</div>
					<!-- Add Pagination -->
					<div class="swiper-pagination"></div>
				</div>
				<section class="goods-title b-color-f padding-all ">
                    <div class="dis-box">
                        <div class="box-flex">
                            <h3 class="twolist-hidden" style="height:inherit;">
                        {if empty($goods.user_id)}
                            <em class="em-promotion">自营</em>
                            {/if}
                            {$goods.goods_name}</h3></div>
                        <span class="heart j-heart {if $goods_collect}active{/if}"  onclick="collect({$goods.goods_id})" id="ECS_COLLECT"><i class="ts-2 shoucang"></i><em class="ts-2">收藏</em></span>
                    </div>
                </section>
				<section class="goods-price padding-all b-color-f">
					<p class="p-price p_go">拼单价<span class="t-first">￥{$group_buy.price_ladder.0.price}</span>
                        {if $group_buy.in_stock}<em class="em-promotion in-stock"><a href="{url('wholesale/index/detail', ['id'=>$group_buy.in_stock])}">有现货</a></em>{/if}</p>
					<p class="p-market gobirl">实体商场零售价<del id="ECS_MARKETPRICE">￥{$goods.market_price}(参考)</del></p>
                    <!--{if $goods.cost_price != 0}-->
                    <p class="p-market">建议零售价<del id="ECS_MARKETPRICE">￥{$goods.cost_price}
                    </del></p>
                    <!--{/if}-->

                    <!-- {if $group_buy.deposit > 0} 保证金额-->
					<p class="p-market">保证金 {$group_buy.formated_deposit}</p>
					<!--{/if}-->
                    <p class=" dis-box g-p-tthree m-top06">
                        <!--{if $group_buy.restrict_amount}-->
                        <span class="box-flex text-left">目标拼单量 <em>&nbsp;&nbsp;{$group_buy.restrict_amount}{$goods.measure_unit}</em></span>
                        <!-- {/if} -->
                        <span class="box-flex text-left">已拼数量
                            <em id="orderG_number" ectype="orderGNumber" data-value="{$orderG_number}">{$orderG_number}</em>{$goods.measure_unit}
                        </span>
                    </p>

                    <p class=" dis-box g-p-tthree m-top06">
                        <!--{if $group_buy.restrict_amount}-->
                        <span class="box-flex text-left">距离目标量 <em>&nbsp;&nbsp;{$group_buy['restrict_amount'] - $orderG_number}{$goods.measure_unit}</em></span>
                        <!-- {/if} -->

                        <span class="box-flex text-left timepro">生产周期<em>&nbsp;&nbsp;{$group_buy.production_cycle}天</em></span>
                    </p>
                    <p class=" dis-box g-p-tthree m-top06">
                        <!--{if $group_buy.moq}-->
                        <span class="box-flex text-left">起拼量≥<em>&nbsp;&nbsp;{$group_buy.moq}件</em></span>
                        <!--{/if}-->
                        <span class="box-flex text-left leiji">累计评价<em>&nbsp;&nbsp;{$comment_all.allmen}人评价</em></span>
                        <!--<span class="box-flex text-left">累计已拼
                            <em>{$orderG_number}</em>{$goods.measure_unit}
                        </span>-->
                    </p>
				</section>
                <section class="m-top04 padding-all b-color-f goods-promotion j-show-div">
                    <div class="dis-box">
                        <label class="t-remark g-t-temark">拼单规则</label>
                        <div class="box-flex g-promotion-con">
                            <div class="box-flex">请须知</div>
                            <!-- <p><em class="em-promotion">拼单人数</em><span class="">{$orderG_number}人</span></p> -->
                        </div><i class="iconfont icon-gantanhao goods-min-icon"></i>
                    </div>
                    <!--服务信息star-->
                    <div class="show-goods-service j-filter-show-div ts-3 b-color-1">
                        <section class="goods-show-title of-hidden padding-all b-color-f">
                            <h3 class="fl g-c-title-h3">拼单说明</h3>
                            <i class="iconfont icon-guanbi2 show-div-guanbi fr"></i>

                        </section>
                        <section class="goods-show-con goods-big-service swiper-scroll">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide b-color-f presale-text">
                                    <p>1.下单后，请在30分钟内付款，超时将自动关闭订单。用户需一次性支付全款；</p>
                                    <p>2.时间达到拼单目标量未达到，拼单金额返还，不发货</p>
                                    <p>3.拼单目标量达到时间未达到，拼单金额不返还，正常发货；</p>
                                    <p>4.拼单结束后，请至“我的订单”内查看订单详情信息；</p>
                                    <p>5.发货时间，因制造商需要一定的生产周期，请留意订单状况；</p>
                                </div>
                            </div>
                            <style>
                                .presale-text{padding:1rem; box-sizing:border-box; color:#666;}
                                .presale-text p{font-size:1.2rem; margin-bottom:.6rem;}
                            </style>
                        </section>
                    </div>
                    <!--服务信息end-->

                </section>

				<section class="m-top08 padding-all b-color-f goods-attr j-goods-attr j-show-div">
					<div class="dis-box">
                        <label class="t-remark g-t-temark">已选</label>
                        <div class="box-flex">请选择</div>
                        <div class="f-04"><span class="t-jiantou"><i class="iconfont icon-jiantou"></i></span></div>
                    </div>
					<!--商品属性弹出层star-->
					<div class="mask-filter-div"></div>
					<div class="show-goods-attr j-filter-show-div ts-3 b-color-1">
						<section class="s-g-attr-title b-color-1  product-list-small">
							<div class="product-div">
								<img class="product-list-img" src="{$goods.goods_img}">
								<div class="product-text">
									<div class="dis-box position-rel">
										<h4 class="box-flex">{$goods.goods_name}</h4>
										<i class="iconfont icon-guanbi2 show-div-guanbi"></i>
									</div>
									<p><span class="p-price t-first ">¥{$group_buy.price_ladder.0.price}</span></p>
									<!-- <p class="dis-box p-t-remark"><span class="box-flex">限购数量：{$group_buy.restrict_amount} {$goods.measure_unit}</span></p> -->
								</div>
							</div>
						</section>

						<section class="s-g-attr-con swiper-scroll b-color-f padding-all m-top1px">
							<div class="swiper-wrapper">
								<div class="swiper-slide">
                                    <!--{if $specification}-->
                                    <!--{$i=0}-->
                                    <!-- {foreach from=$specification item=spec key=spec_key} -->
                                    <!--{$i++}-->
                                    <!--{if $i == count($specification)}-->
                                    {if $spec.values}
                                    <h4 class="t-remark">{$spec.name}</h4>
                                    <div class="main_attr_list is-size" ectype="main_attr_list">
                                    </div>
                                    <ul class="hide" ectype="select_record"></ul>
                                    {/if}
                                    <!--{else}-->
                                    {if $spec.values}
                                    <h4 class="t-remark">{$spec.name}</h4>
                                    <!-- 判断属性是复选还是单选 -->
                                    {if $spec.attr_type == 1}
                                    <ul class="select-one j-get-one m-top10">
                                        {if $spec.is_checked > 0}
                                        <!-- pc有属性图片 -->
                                        {foreach $spec.values as $key=>$val}
                                        <a class="ect-select dis-flex fl" href="javascript:;" {if $val.img_site}onclick="location.href='{$val.img_site}'"{/if}>
                                        <label class="ts-1 {if $val.checked == 1}active{/if}" for="spec_value_{$val.id}">{$val.label}</label>
                                        <input style="display:none" id="spec_value_{$val.id}" type="radio" name="spec_{$spec_key}" value="{$val.id}" {if $val.checked == 1}checked{/if} onclick="changePrice()" />
                                        </a>
                                        {/foreach}
                                        {else}
                                        <!-- pc没属性图片 -->
                                        {foreach $spec.values as $key=>$val}
                                        <a class="ect-select dis-flex fl" href="javascript:;" {if $val.img_site}onclick="location.href='{$val.img_site}'"{/if}>
                                        <label class="ts-1 {if $key == 0}active{/if}" for="spec_value_{$val.id}">{$val.label}</label>
                                        <input style="display:none" id="spec_value_{$val.id}" type="radio" name="spec_{$spec_key}" value="{$val.id}" {if $key == 0}checked{/if} onclick="changePrice()" />
                                        </a>
                                        {/foreach}
                                        <input type="hidden" name="goods_spec" value="{$val.id}" />
                                        {/if}
                                    </ul>
                                    <input type="hidden" name="spec_list" value="{$spec_key}" />
                                    {else}
                                    <ul class="select-one j-get-one m-top10">
                                        {foreach $spec.values as $key=>$val}
                                        <li class="ect-select dis-flex fl">
                                            <label class="ts-1 {if $key == 0}active{/if}" for="spec_value_{$val.id}">{$val.label}</label>
                                            <input type="checkbox" name="spec_{$spec_key}[]" value="{$val.id}" id="spec_value_{$val.id}" onclick="changePrice()" {if $select_key == 0}checked{/if} style="display:none" />
                                        </li>
                                        {/foreach}
                                    </ul>
                                    {/if}
                                    {/if}
                                    <!--{/if}-->
                                    <!--{/foreach}-->
                                    <!--{else}-->
                                    <div class="main_attr_list is-size">
                                        <ul class="select-ul">
                                            <li>
                                                <div class="row4">
                                                    <div class="number">
                                                        <a href="javascript:void(0)" class="decrement btn-reduce">-</a>
                                                        <input name="goods_number" type="text" id="quantity" class="itxt buy-num" value="0" size="10" data-inventory="{$goods.goods_number}">
                                                        <a href="javascript:void(0)" class="increment btn-add">+</a>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                    <!--{/if}-->
								</div>
							</div>
							<div class="swiper-scrollbar"></div>
						</section>
                        <section class="ect-purchasing-order nonall">
                            <!--{if count($specification)}-->
                            <div class="whodet" ectype="whodet">
                                <div class="whodet-list">
                                    <div class="w-number"><em class="org" ectype="w-number">0</em>件</div>
                                    <div class="w-total">共<em class="org" ectype="w-total">0.00</em>元</div>
                                    <div class="w-handle" ectype="w-handle">已选清单<i></i></div>
                                </div>
                                <div class="whodet-goods-info" ectype="wginfo">
                                </div>
                            </div>
                            <!--{else}-->
                            <div class="whodet" ectype="whodet">
                                <div class="whodet-list">
                                    <div class="w-number"><em class="org" ectype="w-number">0</em>个</div>
                                    <div class="w-total">共<em class="org" ectype="w-total">0.00</em>元</div>
                                </div>
                            </div>
                            <!--{/if}-->
                        </section>
						<section class="ect-button-more dis-box hall" style="display: block;">
							<input type="hidden" value="{$goods_id}" id="good_id" name="good_id">
							<input type="hidden" value="{$user_id}" id="user_id" name="user_id">
							<input type="hidden" value="{$area_id}" id="area_id" name="area_id">
                            <input type="hidden" value="{count($specification)}" id="specscount" name="specscount">
							<input type="hidden" value="{$group_buy_id}" id="group_buy_id" name="group_buy_id">
                            <input type="hidden" value="{$group_buy.restrict_amount}" name="restrictShop" ectype="restrictShop" />
                            <div id="attr" style="display: none">
                            </div>
                            <input type="hidden" value="{$group_buy.moq}" id="goods" name="moq" ectype="moq">
                            <a class="btn-disab box-flex quehuo" href="javascript:void(0);" {if $group_buy.is_end != 1}style="display:none"{/if}>拼单结束</a>
							<button type="sumbit" data-type="purchase" class="btn-submit box-flex buy-now" {if $group_buy.is_end == 1}style="display:none"{/if}>确定</button>
						</section>
					</div>
					<!--商品属性弹出层end-->
				</section>
				<section class="m-top08 goods-evaluation">
					<a href="{url('goods/index/comment', array('id'=>$goods.goods_id))}">
						<div class="dis-box padding-all b-color-f  g-evaluation-title">
							<label class="t-remark g-t-temark">用户评价</label>
							<div class="box-flex t-goods1">好评率 <em class="t-first">{$comment_all.goodReview}%</em></div>
							<div class="t-goods1"><em class="t-first">{$comment_all.allmen}</em><span class="t-jiantou">人评论<i class="iconfont icon-jiantou"></i></span></div>
						</div>
					</a>
					{if $good_comment}
					<div class="padding-all m-top1px b-color-f g-evaluation-con">
						<div class="of-hidden evaluation-list">
							<div class="of-hidden ">
								<p class="fl"><span class="grade-star g-star-5 fl"></span><em class="t-remark fl">{$good_comment.0.username}</em>
								</p>
								<p class="fr t-remark">{$good_comment.0.add_time}</p>
							</div>
							<p class="clear m-top10 t-goods1">{$good_comment.0.content}</p>
							{if $good_comment.0.goods}
							<p class="clear m-top08 t-remark">{$good_comment[0]['goods'][0]['goods_attr']}</p>
							{/if}
							<div class="ect-button-more m-top10 dis-box">
								<a href="{url('groupbuy/index/infoimg', array('id'=>$group_buy_id))}" class="box-flex btn-default-new br-5 min-btn">有图评价</a>
								<a href="{url('groupbuy/index/comment', array('id'=>$group_buy_id))}" class="box-flex btn-default-new br-5 min-btn">全部评价</a>
							</div>
						</div>
					</div>
					{/if}
				</section>
				<section class="m-top1px padding-all b-color-f goods-promotion">
					<a href="{url('groupbuy/index/info', array('id'=>$group_buy_id))}">
					<div class="dis-box">
						<label class="t-remark g-t-temark">查看商品详情</label>
						<div class="box-flex"></div>
						<div class="f-04"><span class="t-jiantou"><i class="iconfont icon-jiantou"></i></span></div>
					</div>
					</a>
				</section>
				<section class="m-top08 padding-all goods-shop  b-color-f">
					{if $goods.user_id}
					<div class="goods-shop-info">
						<a href="{$goods.store_url}" class="link-abs"></a>
						<section class="dis-box">
							<div class="g-s-i-img"><img src="{$goods.shopinfo.logo_thumb}"/></div>
							<div class="g-s-i-title box-flex">
								<h3 class="ellipsis-one">{$goods.rz_shopName}</h3>
								<p class="t-remark m-top04">已经有 {$collect_number} 人关注 <span class="fr">参展产品<em class="t-first">{$goods.shopinfo.insale}</em>款</span></p>
							</div>
						</section>
						<section class="dis-box goods-shop-score m-top12">
							<p class="box-flex">
								<label class="fl">商品</label><span class="t-first margin-lr fl">{$merch_cmt['cmt']['commentRank']['zconments']['score']}分</span><em
									class="em-promotion fl">{$merch_cmt['cmt']['commentRank']['zconments']['goodReview']}</em>
							</p>
							<p class="box-flex">
								<label class="fl">服务</label><span class="t-low margin-lr fl">{$merch_cmt['cmt']['commentServer']['zconments']['score']}分</span><em
									class="em-promotion em-p-low fl">{$merch_cmt['cmt']['commentServer']['zconments']['goodReview']}</em>
							</p>
							<p class="box-flex">
								<label class="fl">时效</label><span class="t-center margin-lr fl">{$merch_cmt['cmt']['commentDelivery']['zconments']['score']}分</span><em
									class="em-promotion em-p-center fl">{$merch_cmt['cmt']['commentDelivery']['zconments']['goodReview']}</em>
							</p>
						</section>
					</div>
					{/if}

				    {if $merchant_group_goods}
					<div class="goods-shop-pic of-hidden">
						<h4 class="title-hrbg m-top06"><span>本展厅其他款式的拼单</span>
							<hr>
						</h4>
						<div class="g-s-p-con product-one-list of-hidden scrollbar-none j-g-s-p-con">
							<div class="swiper-wrapper ">
								{foreach $merchant_group_goods as $k=>$v}
								<li class="swiper-slide">
									<div class="product-div">
										<a href="{url('groupbuy/index/detail',array('id'=>$v.act_id))}"><img class="product-list-img" src="{$v.goods_thumb}"/></a>
										<div class="product-text m-top06">
											<a href="{url('groupbuy/index/detail',array('id'=>$v.act_id))}"><h4>{$v.act_name}</h4></a>
											<p><span class="p-price t-first ">
                                                {if $v.promote_price}
                                                {$v.promote_price}
                                                {else}
                                                {$v.shop_price}
                                                {/if}
                                            </span>
											</p>
										</div>
									</div>
								</li>
								{/foreach}
							</div>
						</div>
					</div>
					{/if}


				   <div class="ect-button-more n-ect-button-more m-top10 dis-box goods-shop-btn">
                        {if isset($basic_info.kf_appkey) && !empty($basic_info.kf_appkey)}
                            <a class="box-flex  btn-default-new br-5 min-btn" href="{url('chat/yunwang/index', array('goods_id'=> $goods.goods_id))}"><i class="iconfont icon-kefu t-first"></i>联系客服</a>
                        {elseif isset($basic_info.meiqia) && !empty($basic_info.meiqia)}
                            <a class="box-flex  btn-default-new br-5 min-btn" href="https://static.meiqia.com/dist/standalone.html?eid={$basic_info.meiqia}"><i class="iconfont icon-kefu t-first"></i>联系客服</a>
                        {else}
                            {if $basic_info.kf_type}
                            <a class="box-flex  btn-default-new br-5 min-btn" href="http://www.taobao.com/webww/ww.php?ver=3&touid={$basic_info.kf_ww}&siteid=cntaobao&status=1&charset=utf-8"><i class="iconfont icon-kefu t-first"></i>联系客服</a>
                            {else}
                            <a class="box-flex  btn-default-new br-5 min-btn" href="http://wpa.qq.com/msgrd?v=3&uin={$basic_info.kf_qq}&site=qq&menu=yes"><i class="iconfont icon-kefu t-first"></i>联系客服</a>
                            {/if}
                            {if $goods.user_id}
                            <a class="box-flex  btn-default-new br-5 min-btn" href="{$goods.store_url}"><i class="iconfont icon-dianpu t-two"></i>进入展厅</a>
                            {/if}
                        {/if}
                    </div>
				</section>

			</div>

			<!--悬浮btn star-->
			<section class="filter-btn dis-box">
				      {if isset($basic_info.kf_appkey) && !empty($basic_info.kf_appkey)}
                    <a class="filter-btn-kefu heart " href="{url('chat/yunwang/index', array('goods_id'=> $goods.goods_id))}"><i class="kefu"></i><em>客服</em></a>
                {elseif isset($basic_info.meiqia) && !empty($basic_info.meiqia)}
                    <a class="filter-btn-kefu heart" href="https://static.meiqia.com/dist/standalone.html?eid={$basic_info.meiqia}"><i class="kefu"></i><em>客服</em></a>
                {else}
                    {if $basic_info.kf_type}
                    <a class="filter-btn-kefu filter-btn-a" href="http://www.taobao.com/webww/ww.php?ver=3&touid={$basic_info.kf_ww}&siteid=cntaobao&status=1&charset=utf-8"><i class="kefu"></i><em>客服</em></a>
                    {else}
                    <a class="filter-btn-kefu filter-btn-a" href="http://wpa.qq.com/msgrd?v=3&uin={$basic_info.kf_qq}&site=qq&menu=yes"><i class="iconfont icon-kefu"></i><em>客服</em></a>
                    {/if}
                {/if}

                {if $goods.user_id}
                <a class="filter-btn-shop filter-btn-a" href="{url('cart/index/index')}"><i class="iconfont icon-gouwuche"></i><em>进货单</em></a>
                {/if}

               <!--  <a class="filter-btn-flow  heart j-heart {if $goods_collect}active{/if}" onclick="collect({$goods.goods_id})" id="ECS_COLLECT">
                <i class="shoucang ts-2"></i>
                <em>收藏</em>
                </a> -->

                <!--{if $group_buy.is_end != 1}-->
                <!--{if $group_buy.is_start != 1}-->
                <a class="btn-disab box-flex quehuo" href="javascript:void(0);" >即将开始</a>
                <!--{else}-->
                <a href="javascript:;" class="btn-cart box-flex j-add-cart click-show-attr" data-type="cart">加入进货单</a>
                <a class="btn-submit box-flex add-to-cart click-show-attr" data-type="purchase" href="javascript:void(0);" >立即拼单</a>
                <!--{/if}-->
                <!--{else}-->
                {if $next_url}
                <a class="btn-disab box-flex quehuo" href="{$next_url}" >进入新的一轮</a>
                {else}
                <a class="btn-disab box-flex quehuo" href="javascript:void(0);" >拼单结束</a>
                {/if}
                <!--{/if}-->
			</section>
			<!--悬浮btn end-->
	</form>
</div>

    {include file="image"}
	{include file="page_footer"}
    {include file="float_nav"}
    {include file="float_nav_footer"}

    <div name="by-mobile-lightbox-touch" class="by-lightbox by-lightbox-mobile">
        <div class="by-lightbox-box">
        <div class="by-lightbox-content">
            <div class="by-lightbox-description">
                <div class="duration-tip-title">生产周期说明</div>
                <div class="duration-tip-wrap">
                <p>为了使您采购到订单式厂价产品，我们厂预先是不备库存的，将根据订单生产会有一定的生产周期，新款首单略微长点，后续补单会很快，因此请您耐心等待哦！</p>
                </div>
            </div>
        </div>
        <div class="by-lightbox-button popup-kk"><span class="btn confirm">我知道了</span></div>
        </div>
    </div>
    <div name="by-mobile-lightbox-touch" class="by-lightbox-layout by-lightbox" style="height: 7918px;"></div>


    <script>

        // 生产周期说明弹出层
        $('.timepro').click( function(){
        $('.by-lightbox').css({
            display: 'block',
            // height: $(document).height()
        })
        var $Popup = $('.popup-kk');
        $Popup.css({
        left: ($('body').width() - $Popup.width()) / 2+ 'px',
        top: ($(window).height() - $Popup.height()) / 2 + $(window).scrollTop() + 'px',
        display: 'block'
        })
        $("body").css({overflow:"hidden"})
    })

    $('.btn').click(function(){
        $('.by-lightbox,.popup-kk').css('display', 'none');
        $("body").css({overflow:""})
    })


        var user_id = '{$user_id}';
		/*点击弹出搜索层*/
		$(".j-price-ladder").click(function() {
			$(".t-price-ladder").toggleClass("active");
		});
		/*商品详情相册切换*/
			var swiper = new Swiper('.goods-photo', {
				paginationClickable: true,
				onInit: function(swiper) {
					document.getElementById("g-active-num").innerHTML = swiper.activeIndex + 1;
					document.getElementById("g-all-num").innerHTML = swiper.slides.length;
				},
				onSlideChangeStart: function(swiper) {
					document.getElementById("g-active-num").innerHTML = swiper.activeIndex + 1;
				}
			});


			/*店铺信息商品滚动*/
			var swiper = new Swiper('.j-g-s-p-con', {
				scrollbarHide: true,
				slidesPerView: 'auto',
				centeredSlides: false,
				grabCursor: true
			});
			$(function(){
				//相册
    			initPhotoSwipeFromDOM('.my-gallery-box');
				changePrice();
				//商品详情属性弹出层
				$(".click-show-attr").click(function(){
                    var type = $(this).data('type');
                    $('.buy-now').attr('data-type', type);
					$(".show-goods-attr").addClass("show");
					$(".mask-filter-div").addClass("show");
				});


                $("*[ectype='w-handle']").on("click",function(){
                    var parent = $(this).parents("*[ectype='whodet']");
                    var wginfo = parent.find("*[ectype='wginfo']");
                    var top = wginfo.height();
                    wginfo.css({"top":-(top+2)});
                    if(parent.hasClass("whodet-cur")){
                        parent.removeClass("whodet-cur");
                        wginfo.hide();
                    }else{
                        parent.addClass("whodet-cur");
                        wginfo.show();
                    }
                });
                $("*[ectype='wginfo']").hide();

                $(document).on('click', '.btn-add',function(){
                    var quantity  = 0;

                    //查看是否设置属性
                    var specscount = parseInt($("input[name='specscount']").val());
                    if (specscount) {
                        $("[ectype='select_record'] li").each(function (i) {
                            var num = parseInt($(this).attr('data-num'));
                            quantity += num;
                        })
                    } else {
                        quantity = $("input[name='goods_number']").val();
                    }

                    quantity = Number(quantity);

                    var perNumber =Number($("*[ectype='perNumber']").val()),
                            restrictShop = Number($("*[ectype='restrictShop']").val()),
                            ogNumber = Number($("*[ectype='orderGNumber']").data("value"));


                    if(perNumber == 0 || quantity > perNumber){
                        d_messages('商品库存不足');
                        return false;
                    }else if((quantity+ogNumber) >= restrictShop  && restrictShop > 0){
                        d_messages('该商品已经累计超过限购数量');
                        return false;
                    }

                    var num = $(this).siblings('.buy-num').val();
                    num = parseInt(num);
                    $(this).siblings('.buy-num').val(num+1);

                    $("*[ectype='whodet']").show();
                    set_select_record($(this));
                })

                $(document).on('click', '.btn-reduce',function(){
                    var num = $(this).siblings('.buy-num').val();
                    num = parseInt(num);
                    if(num>0){
                        $(this).siblings('.buy-num').val(num-1);
                    }

                    set_select_record($(this));
                })

                $(document).on('keyup', '.buy-num', function(){
                    if($(this).val() < 0 || isNaN($(this).val()) || $(this).val() == ''){
                        $(this).val(0);
                    }
                    $("*[ectype='whodet']").show();
                    set_select_record($(this));
                });

                $(document).on('blur', '.buy-num', function(){
                    var quantity  = 0;
                    $("[ectype='select_record'] li").each(function(i){
                        var num =  parseInt($(this).attr('data-num'));
                        quantity += num;
                    })

                    var perNumber =Number($("*[ectype='perNumber']").val()),
                            restrictShop = Number($("*[ectype='restrictShop']").val()),
                            ogNumber = Number($("*[ectype='orderGNumber']").data("value"));

                    if(perNumber == 0 || quantity > perNumber){
                        $(this).val(0);
                        set_select_record($(this));
                        pbDialog(json_languages.Stock_goods_null,"",0);
                        return false;
                    }else if((quantity+ogNumber) > restrictShop  && restrictShop > 0){
                        $(this).val(0);
                        set_select_record($(this));
                        pbDialog(json_languages.purchasing_prompt_two,"",0,500);
                        return false;
                    }

                    var val = $(this).val();
                    if(val.length>1){
                        $(this).val(val.replace(/\b(0+)/gi,""));
                    }
                });

                $('.buy-now').bind('click', function(){
                    var perNumber =Number($("*[ectype='perNumber']").val()),
                            restrictShop = Number($("*[ectype='restrictShop']").val()),
                            ogNumber = Number($("*[ectype='orderGNumber']").data("value"));
                    var moq = parseInt($("input[name='moq']").val());

                    //查看是否设置属性
                    var attr_array = new Array();
                    var num_array = new Array();

                    $('#attr').html('');
                    var quantity  = 0;
                    var specscount = parseInt($("input[name='specscount']").val());
                    if (specscount > 0) {
                        $("[ectype='select_record'] li").each(function(i){
                            var attr = $(this).attr('data-attr');
                            var num =  parseInt($(this).attr('data-num'));
                            $('#attr').append('<input name="attr_array['+attr+']" value="'+num+'">');
                            quantity += num;
                        })
                    } else {
                        quantity = $("input[name='goods_number']").val();
                    }

                    quantity = Number(quantity);

                    if(user_id && parseInt(user_id) > 0){
                        if (quantity <= 0) {
                            d_messages('您选择您需要购买的商品', '', 0);
                            return false;
                        }

                        if (moq && moq > quantity) {
                            d_messages('您订购的商品少于最小起订量', '', 0);
                            return false;
                        }

                        if(perNumber == 0 || quantity > perNumber){
                            d_messages('商品库存不足',"",0);
                            return false;
                        }else if((quantity+ogNumber) > restrictShop  && restrictShop > 0){
                            d_messages('对不起，该商品已经累计超过限购数量',"",0,500);
                            return false;
                        }else{
                            return true;
                        }
                    }else{
                        var group_buy_id = $("input[name='group_buy_id']").val();
                        var back_url = "group_buy.php?act=view&id=" + group_buy_id;

                        layer.open({
                            content: '请登录后关注登录',
                            btn: ['立即登录', '取消'],
                            shadeClose: false,
                            yes: function () {
                                window.location.href = ROOT_URL + "index.php?m=user&c=login";
                            },
                            no: function () {
                            }
                        });
                        return false;
                    }

                    return false;
                });

                $("form[name='ECS_FORMBUY']").Validform({
                    tiptype: function (msg) {
                        d_messages(msg);
                    },
                    tipSweep: true,
                    ajaxPost: true,
                    callback: function (data) {
                        if (data.error) {
                            d_messages(data.message)
                        } else {
                            if ($('.buy-now').data('type') == 'cart') {
                                d_messages(data.message)
                                //清空
                                $('.buy-num').val(0)
                                $("[ectype='w-number']").html(0);
                                $("[ectype='w-total']").html(0.00);
                                $("[ectype='main_attr_list'] .price").html('');
                                $("[ectype='wginfo']").html('');
                                $("#attr").html('');
                                $("*[ectype='select_record']").html('');
                                $('.show-goods-attr .show-div-guanbi').trigger('click')
                                $("[ectype='wginfo']")
                            } else {
                                d_messages(data.message)
                                window.location.href = ROOT_URL + "index.php?m=cart&c=index"
                            }
                        }
                    }
                })
			})

        //设置添加记录
        function set_select_record(obj){
            //转换对象
            if(!obj.hasClass('buy-num')){
                obj = obj.siblings('.buy-num');
            }
            var num = obj.val(); //数量

            //查看是否设置属性
            var specscount = parseInt($("input[name='specscount']").val());
            var attr_group = obj.parents("[ectype='attr_group']").data('attr_group');
            if(num > 0){
                if($("[ectype='select_record'] [data-attr='"+attr_group+"']").length == 0){
                    var html = "<li data-attr='"+attr_group+"' data-num='"+num+"'></li>";
                    $("[ectype='select_record']").append(html)
                }else{
                    $("[ectype='select_record'] [data-attr='"+attr_group+"']").attr('data-num', num);
                }
            }else if (num == 0){
                $("[ectype='select_record'] [data-attr='"+attr_group+"']").remove();
            }

            calculate_select_record();
        }

        var act_id = {$group_buy_id}
        //获取添加记录
        function get_select_record(){
            $("[ectype='attr_group']").each(function(){
                var attr_group = $(this).data('attr_group');
                var select_num = $("[ectype='select_record']").find("[data-attr='"+attr_group+"']").attr('data-num');
                if(/\d+/.test(select_num)){
                    $(this).find(".buy-num").val(select_num);
                }else{
                    $(this).find(".buy-num").val(0);
                }
            })
        }

        //计算数量价格
        function calculate_select_record(){
            var goods_id = $("input[name='goods_id']").val();

            //查看是否设置属性
            var specscount = parseInt($("input[name='specscount']").val());
            if(specscount > 0){
                //查看是否设置属性
                var attr_array = new Array();
                var num_array = new Array();

                $("[ectype='select_record'] li").each(function(i){
                    var attr = $(this).attr('data-attr');
                    var num = $(this).attr('data-num');
                    attr_array.push(attr);
                    num_array.push(num);
                })

                //异步处理
                $.ajax({
                    url:'{url("get_select_record")}',
                    type:'get',
                    data:{'act_id':act_id, 'attr_array':attr_array, 'num_array':num_array}, //传递数组数据
                    dataType:'json',
                    success:function(data){
                        $("[ectype='w-number']").html(data.total_number);
                        $("[ectype='w-total']").html(data.data.total_price_formatted);
                        $("[ectype='main_attr_list'] .price").html(data.data.unit_price_formatted);
                        $("[ectype='wginfo']").html(data.record_data);
                    }
                })
            } else {
                var goods_number = $("input[name='goods_number']").val();
                $.ajax({
                    url:'{url("get_select_record")}',
                    type:'get',
                    data:{'act_id':act_id, 'goods_number':goods_number}, //传递数组数据
                    dataType:'json',
                    success:function(data){

                        $("[ectype='w-number']").html(data.total_number);
                        $("[ectype='w-total']").html(data.data.total_price_formatted);
                        $(".si-lie-list .price").html(data.data.unit_price_formatted);
                    }
                })
            }
        }

			/**
			 * 点选可选属性或改变数量时修改商品价格的函数
			 */
			function changePrice(type)
			{
				var max_number = {if $xiangou == 1}{if $goods.is_xiangou==1 && $goods.xiangou_num > 0}{$goods.xiangou_num}{else}-1{/if}{else}-1{/if};
				var min_number = 1;
				var qty = $("#goods_number").val();
				if(type == 1){
					if(qty >= min_number){
						qty--;
					}
				}
				if(type == 3){
					if(max_number == -1){
						max_number = $(".goods_attr_num").html() ? parseInt($(".goods_attr_num").html()) : 1;
					}
					if(qty <= max_number){
						qty++;
					}
				}
				if(qty <=0 ){ qty=1; }
				if(!/^[0-9]*$/.test(qty)){ qty = 1 }
				var attr = getSelectedAttributes(document.forms['ECS_FORMBUY']);
                var attr_id = getSelectedAttributesGroup(document.forms['ECS_FORMBUY']);
                attr_id = attr_id && attr_id.length ? parseInt(attr_id) : '';
				$('input[name=goods_spec]').val(attr);

				//ecmoban模板堂 --zhuo start 限购
				{if $xiangou == 1}
				{if $goods.is_xiangou == 1 && $goods.xiangou_num > 0}
				var xiangou_num = {$goods.xiangou_num};
				var xiangou = {$xiangou};
				if(qty > xiangou_num && xiangou_num > 0 && xiangou == 1){
					d_messages('不能超过限购数量');
					return false;
				}
				{/if}
				{/if}
				var warehouse = {if $region_id}{$region_id}{else}0{/if};
				var area = {if $area_id}{$area_id}{else}0{/if};
				$.get('{url("price")}', {'act_id':{$group_buy_id}, 'attr':attr, 'goods_attr':attr_id,'warehouse_id':warehouse, 'area_id':area}, function(data){
					changePriceResponse(data);
				}, 'json');
			}

            /**
             * 接收返回的信息
             */
            function changePriceResponse(res){
                if (res.err_msg.length > 0){
                    d_messages(res.err_msg);
                } else {
                    //by wu
                    $("[ectype='main_attr_list']").html(res.main_attr_list);

                    get_select_record()
                }
            }

			/**
			 * 接收返回的信息
			 */
			function changePriceResponse2(res){
				if (res.err_msg.length > 0){
					d_messages(res.err_msg);
				} else {
					//属性图片
					if(res.attr_img) {
						$(".s-g-attr-title .product-list-img").attr('src',res.attr_img);
					}
					//用户可购买的数量
					$("#goods_number").val(res.qty);
					//更改数量的同时显示
					var get_text = '';
					s_get_label = $(".show-goods-attr .s-g-attr-con").find("label.active"); //获取被选中label
					if(s_get_label.length > 0){
						s_get_label.each(function() {
							get_text += $(this).text() + "、";
						});
					}
					var goods_number = $("#goods_number").val();
					goods_number = parseInt(goods_number) ? parseInt(goods_number) : 1;
					get_text = get_text + goods_number + "个";
//					$(".j-goods-attr").find(".t-goods1").text(get_text);
					if ($(".goods_attr_num").length > 0){
						$(".goods_attr_num").html(res.attr_number);
					}
					if(res.err_no == 2){
						d_messages("该地区暂不支持配送");
					}
					else{
						if(res.attr_number <= 0){
							$(".add-to-cart").hide();
							$(".quehuo").show().text("已抢完");
						}
						else{
							{if $goods.is_end != 1}
							$(".add-to-cart").show();
							$(".quehuo").hide();
							{/if}
						}
					}
					//总价
					if ($("#ECS_GOODS_AMOUNT").length > 0){
						$("#ECS_GOODS_AMOUNT").html(res.result);
					}
					if($("#ECS_SHOPPRICE").length > 0){
						$("#ECS_SHOPPRICE").html(res.shop_price);
					}
					if($("#ECS_DISCOUNT").length > 0){
						$("#ECS_DISCOUNT").html(res.discount);
					}
				}
			}

			function get_groupbuy(){
				var qty = $("#goods_number").val();
				var number = Number($('.data-item').html()); //库存
				var restrict_amount = Number({$group_buy.restrict_amount}); //限购数量
				var attr = getSelectedAttributes(document.forms['ECS_FORMBUY']);
				$('input[name=goods_spec]').val(attr);

				if(restrict_amount > 0 && restrict_amount < qty){
					var message = "您最多可拼单" + restrict_amount + "件商品!";
					d_messages(message);
					return false;
				}

				if(qty > number){
					var message = "库存不足，您最多可拼单" + number + "件商品!";
					d_messages(message);
					return false;
				}
			}
			 /*拼单详情倒计时*/
			$.extend($.fn,{
				fnTimeCountDown:function(d){
					this.each(function(){
						var $this = $(this);
						var o = {
							sec: $this.find(".sec"),
							mini: $this.find(".mini"),
							hour: $this.find(".hour"),
							day: $this.find(".day")
						};
						var f = {
							haomiao: function(n){
								if(n < 10)return "00" + n.toString();
								if(n < 100)return "0" + n.toString();
								return n.toString();
							},
							zero: function(n){
								var _n = parseInt(n, 10);//解析字符串,返回整数
								if(_n > 0){
									if(_n <= 9){
										_n = "0" + _n
									}
									return String(_n);
								}else{
									return "00";
								}
							},
							dv: function(){
								d = d || Date.UTC(2050, 0, 1); //如果未定义时间，则我们设定倒计时日期是2050年1月1日
								var _d = $this.data("end") || d;
								var now = new Date(),
										endDate = new Date(_d.replace(/-/g, "/"));
								//现在将来秒差值
								//alert(future.getTimezoneOffset());
								var dur = (endDate - now.getTime()) / 1000 , mss = endDate - now.getTime() ,pms = {
									sec: "00",
									mini: "00",
									hour: "00",
									day: "00",
								};
								if(mss > 0){
									pms.sec = f.zero(dur % 60);
									pms.mini = Math.floor((dur / 60)) > 0? f.zero(Math.floor((dur / 60)) % 60) : "00";
									pms.hour = Math.floor((dur / 3600)) > 0? f.zero(Math.floor((dur / 3600)) % 24) : "00";
									pms.day = Math.floor((dur / 86400)) > 0? f.zero(Math.floor((dur / 86400))) : "00";

								}else{
									pms.day=pms.hour=pms.mini=pms.sec="00";
									$(".btn-submit").remove();
									$(".btn-disab").css('display','block');
								}
								return pms;
							},
							ui: function(){
								if(o.sec){
									o.sec.html(f.dv().sec);
								}
								if(o.mini){
									o.mini.html(f.dv().mini);
								}
								if(o.hour){
									o.hour.html(f.dv().hour);
								}
								if(o.day){
									o.day.html(f.dv().day);
								}
								setTimeout(f.ui, 1);
							}
						};
						f.ui();
					});
				}
			});
		</script>
		<script type="text/javascript">
			$("#fnTimeCountDown").fnTimeCountDown("{$group_buy.formated_end_date}");
		</script>
